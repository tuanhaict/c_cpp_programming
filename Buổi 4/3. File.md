# File

Để làm việc với file, ta dùng thư viện `<stdio.h>`, cũng là thư viện dùng cho đọc và ghi.

Kiểu dữ liệu khi làm việc với file là con trỏ `FILE*`

Làm việc với file có 3 giai đoạn: `mở file -> đọc/ghi -> đóng file`.

## 1. Mở file

`Cú pháp`: `fopen(<tên file>, <mode>)`

### Các loại mode:
- `r`: Mở file để đọc, **yêu cầu file tồn tại**
- `w`: mở file để ghi đè.
- `a`: mở file để ghi nối tiếp (viết tắt của append).
- `r+`: đọc và ghi, **yêu cầu file tồn tại**
- `w+`: đọc và ghi đè.
- `a+`: đọc và ghi nối tiếp.
- Thêm `b` vào nếu làm việc với file nhị phân (tức là không phải dạng text), ví dụ `rb`, `rb+`.

```c
FILE *fp = fopen("data.txt", "r");
if (fp == NULL) {
    printf("Không thể mở file!\n");
    return 1;
}
```
## 2. Đóng file

Dùng để đóng file lại sau khi hết phiên làm việc, giải phóng tài nguyên hệ thống.

`Cú pháp`: `fclose(<con trỏ file>);`

## 3. Đọc và ghi file.

### 3.1 Đọc file

- `fscanf()`: dùng để đọc file theo định dạng (giống `scanf`).
- `fgets()`: đọc file theo từng dòng.
- `fgetc()`: đọc từng kí tự.
- `fread()`: đọc file nhị phân.

#### Ví dụ đọc file từng kí tự đến khi kết thúc.
```c
FILE *fp;
int ch;

fp = fopen("example.txt", "r");  // mở file ở chế độ đọc
if (fp == NULL) {
    printf("Không thể mở file!\n");
    return 1;
}

// đọc từng ký tự cho đến khi hết file
while ((ch = fgetc(fp)) != EOF) {
    putchar(ch);
}

fclose(fp);
```

#### Ví dụ đọc file từng dòng.
```c
char line[100];
int line_num = 1;

while (fgets(line, sizeof(line), fp)) {
    printf("Dòng %d: %s", line_num, line);
    line_num++;
}
```

#### Ví dụ đọc file theo định dạng

Giả sử có file như sau:

```txt
101 Nam 8.5
102 Linh 9.2
103 Huy 7.8
```

```c
int id;
char name[30];
float score;

printf("Danh sách sinh viên:\n");
while (fscanf(fp, "%d %s %f", &id, name, &score) == 3) {
    printf("ID: %d, Tên: %s, Điểm: %.1f\n", id, name, score);
}
```

#### Ví dụ về đọc file nhị phân

Giả sử file nhị phân lưu trữ struct Student

```c
FILE *fp = fopen("students.bin", "rb");
if (fp == NULL) {
    printf("Không thể mở file nhị phân!\n");
    return 1;
}

Student s;

printf("Dữ liệu đọc được:\n");
while (fread(&s, sizeof(Student), 1, fp) == 1) {
    printf("Tên: %s, Tuổi: %d\n", s.name, s.age);
}

fclose(fp);
```
Đọc từng giá trị Student, và lưu vào `s`.

### 3.2 Ghi file

- `fprintf()`: dùng để ghi file theo định dạng (giống `printf`).
- `fputs()`: ghi file theo chuỗi.
- `fputc()`: ghi từng kí tự.
- `fwrite()`: ghi file nhị phân.

#### Ví dụ ghi file từng kí tự.
```c
for (char c = 'A'; c <= 'Z'; c++) {
    fputc(c, fp);
    fputc(' ', fp);
}
```

#### Ví dụ ghi file từng chuỗi.
```c
fputs("Xin chào C!\n", fp);
fputs("Lập trình C rất thú vị.\n", fp);
```

#### Ví dụ ghi file theo định dạng

```c
int id = 101;
char name[] = "Linh";
float score = 9.0;

fprintf(fp, "ID: %d\n", id);
fprintf(fp, "Tên: %s\n", name);
fprintf(fp, "Điểm: %.2f\n", score);
```

#### Ví dụ về ghi file nhị phân

Giả sử file nhị phân lưu trữ struct Student

```c
Student s1 = {"Linh", 19};
Student s2 = {"Nam", 21};

FILE *fp = fopen("students.bin", "wb");
if (!fp) {
    printf("Không thể mở file!\n");
    return 1;
}

fwrite(&s1, sizeof(Student), 1, fp);
fwrite(&s2, sizeof(Student), 1, fp);

fclose(fp);
```