
# B√†i gi·∫£ng: UNION & BIT FIELDS
# 1. Union trong C

## 1.1 Kh√°i ni·ªám

**union** l√† m·ªôt c·∫•u tr√∫c ƒë·∫∑c bi·ªát ‚Äúgi·ªëng struct nh∆∞ng **c√°c th√†nh ph·∫ßn ƒë∆∞·ª£c l∆∞u chung trong c√πng m·ªôt √¥ nh·ªõ**‚Äù.  
‚Üí Dung l∆∞·ª£ng c·ªßa union b·∫±ng k√≠ch th∆∞·ªõc c·ªßa **th√†nh ph·∫ßn l·ªõn nh·∫•t**.

ƒêi·ªÅu n√†y gi√∫p ti·∫øt ki·ªám b·ªô nh·ªõ trong c√°c tr∆∞·ªùng h·ª£p ta ch·ªâ c·∫ßn d√πng m·ªôt tr∆∞·ªùng t·∫°i m·ªôt th·ªùi ƒëi·ªÉm.

## 1.2 V√≠ d·ª•

### V√≠ d·ª• 1

```c
union char_and_ascii
{
    char ch;
    int ascii_val;
};

union char_and_ascii obj;

obj.ascii_val = 0;
obj.ch = 'A';

printf("character = [%c], ascii_value = [%u]\n", obj.ch, obj.ascii_val);
// Output: character = [A], ascii_value = [65]
```

üìå √ù nghƒ©a:

- `ch` v√† `ascii_val` tr·ªè v√†o c√πng m·ªôt v√πng nh·ªõ.
- Khi g√°n `'A'` v√†o `ch`, ta ƒë·ªçc l·∫°i v√πng nh·ªõ ƒë√≥ d∆∞·ªõi d·∫°ng `unsigned short`, n√™n nh·∫≠n ƒë∆∞·ª£c gi√° tr·ªã ASCII c·ªßa A l√† **65**.

---

### V√≠ d·ª• 2

```c
union SOME_TYPES {
    char character;
    short shortinteger;
    int integer;
} my_space;

my_space.integer = 0x12345678;

// little endian:
// character    = 0x78
// shortinteger = 0x5678
```
---

### V√≠ d·ª• 3 ‚Äì Union v·ªõi struct ƒë·ªÉ xem t·ª´ng byte

```c
union
{
    int integer;
    struct
    {
        char firstByte;
        char secondByte;
        char thirdByte;
        char fourthByte;
    } Bytes;
} h;

h.integer = 0x12345678;
h.Bytes.firstByte = 0x23;
h.Bytes.secondByte = 0x56;

// little endian:
// firstByte  = 0x78
// secondByte = 0x56
```
# 2. Bit Fields trong C

## 2.1 Kh√°i ni·ªám

Bit field l√† m·ªôt d·∫°ng struct cho ph√©p **c√°c tr∆∞·ªùng c√≥ k√≠ch th∆∞·ªõc t√≠nh b·∫±ng bit**, th∆∞·ªùng d√πng ƒë·ªÉ gi·∫£m b·ªô nh·ªõ ho·∫∑c √°nh x·∫° c√°c thanh ghi ph·∫ßn c·ª©ng.

H·∫°n ch·∫ø:

- Kh√¥ng d√πng ƒë∆∞·ª£c to√°n t·ª≠ `&` ƒë·ªÉ l·∫•y ƒë·ªãa ch·ªâ c·ªßa m·ªôt bit-field.
- Kh√¥ng d√πng ƒë∆∞·ª£c `sizeof` ƒë·ªÉ ƒëo t·ª´ng bit-field.
- T·ªëc ƒë·ªô c√≥ th·ªÉ ch·∫≠m h∆°n so v·ªõi thao t√°c bit tr·ª±c ti·∫øp.

---

## 2.2 V√≠ d·ª•

### Struct th√¥ng th∆∞·ªùng:

```c
struct example1
{
    int isMemoryAllocated;
    int isObjectAllocated;
};
```

‚Üí M·ªói tr∆∞·ªùng d√πng **4 bytes** (int).

### Bit-field:

```c
struct example2
{
    int isMemoryAllocated : 1;
    int isObjectAllocated : 1;
};
```

‚Üí M·ªói tr∆∞·ªùng ch·ªâ chi·∫øm **1 bit**.

---

## 2.3 V√≠ d·ª•

```c
typedef struct
{
    int bit_0: 1;
    int bit_1: 1;
    int bit_2: 1;
    int bit_3: 1;
    int bit_4: 1;
    int bit_5: 1;
    int bit_6: 1;
    int bit_7: 1;
} bits;
```


```c
#include <stdio.h>

struct PersonStatus {
    unsigned gender : 1;   // 0=female, 1=male
    unsigned alive  : 1;   // 0=no, 1=yes
    unsigned age    : 7;   // 0‚Äì127 tu·ªïi
};

int main() {
    struct PersonStatus p;

    p.gender = 1;   // nam
    p.alive  = 1;   // c√≤n s·ªëng
    p.age    = 20;

    printf("gender=%u, alive=%u, age=%u\n",
        p.gender, p.alive, p.age);
}

```
```c
#include <stdio.h>

struct TrafficLight {
    unsigned red    : 1;
    unsigned yellow : 1;
    unsigned green  : 1;
};

int main() {
    struct TrafficLight t = {0};

    t.red = 1;
    printf("Red=%u, Yellow=%u, Green=%u\n",
           t.red, t.yellow, t.green);

    t.red = 0;
    t.green = 1;
    printf("Red=%u, Yellow=%u, Green=%u\n",
           t.red, t.yellow, t.green);
}

```
